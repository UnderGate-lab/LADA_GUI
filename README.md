# lada簡易GUI解説

## ０．本プログラムの目的

大量のモザイク付き動画を所有する方向けに、ladaのデモザイク効果を迅速に確認することを目的とします。

## １．主な機能

- 動画ファイル指定
- プレビュー
- デモザイク処理範囲指定（1箇所）
- lada処理状況表示

## ２．処理内容

指定された範囲の動画を切り出ししてLADA実行スクリプトに渡すだけです。
切り出し動画、デモザイクされた動画ともladaインストール先のoutputフォルダに出力します。

`LADA_LAUNCHER_FOR_GUI.ps1` は以下の変更をおこなっています。

- 出力ファイル先のファイル名にモザイク検出モデル種別を追加
- 同名ファイルが存在する場合に上書き回避のファイル名変更
- 出力動画ファイルの品質向上（ビットレート変更、ffmpeg -crf値）

## ３．インストール方法

### （１）追加パッケージのインストール

以下の追加パッケージが必要です。
pip（Pythonのパッケージ管理ツール）を使用してインストールしてください。

```bash
pip install opencv-python
pip install Pillow
pip install TkinterDnD2
```

※ladaプログラムを外部プログラムとして呼び出すだけなのでどのpython環境で動作させても問題ありません。
ladaが動作するpython環境で動作させることもできます。
`python -m pip install <Package>`により、実行したpythonコマンドのpython環境にパッケージがインストールされます。

### （２）ffmpeg.exeのコピー

ladaインストールフォルダの`\python`の下にある`ffmpeg.exe`をladaインストールフォルダ直下にコピー（※移動ではない）してください。
これは動画切り出しに使用するためです。
環境変数にffmpeg.exeのパスが通っている場合はこの作業は不要です。

### （３）プログラム、スクリプトのコピー

上記2つをladaインストールフォルダにコピーします。

- `lada_gui.py`
- `LADA_LAUNCHER_FOR_GUI.ps1`

lada_gui.pyからこのps1を呼び出します。

## ４．実行方法

LADAフォルダから以下のコマンドを実行

```bash
python lada_gui.py
```

ショートカットを作成すると便利です。

- ショートカットのプロパティの[リンク先]に `python Lada_gui.py` を指定して一旦保存し、
- その後、[作業フォルダー]にLadaインストールフォルダを指定
- [実行時の大きさ]は最小化。
- 作成したショートカットをダブルクリックすると画面が開きます。

## ５．操作方法

ファイルを選択して範囲指定して処理開始を押します。
ladaが動画ファイルのタイムスタンプにセンシティブなため動画切り出しのオプションを追加しました。
再エンコード（h264_nvenc）にするとエラーがでないと思います。

切り出し動画はffmpegの次のオプションで実行（プログラム内にハードコード）

- コピーのみ：`-c copy`
- コピー＋タイムスタンプ補正：`-c copy -fflags +genpts`
- 再エンコード：`-c:v h264_nvenc -c:a aac -preset fast -rc vbr_hq -crf <設定値>`

ウィンドウの下方にlada本体の処理状況を表示しています。
エラーが発生した場合はこちらを参考にしてください。
画面解像度がFHD未満の場合はウィンドウ枠を拡大しないと表示されないかもしれません。

### ＜キー操作など＞

- `←`：300フレーム戻す
- `→`：300フレーム進む
- `SHIFT+←`：30フレーム戻す
- `SHIFT+→`：30フレーム進む
- マウスホイール↑↓：戻る、進む
- `↑`：範囲の開始時間に移動
- `↓`：範囲の終了時間に移動
- `CTRL+↑`：現在の位置を開始時間に設定
- `CTRL+↓`：現在の位置を終了時間に設定
- `HOME`：先頭を開始時間に設定
- `END`：末尾を終了時間に設定
- `CTRL+R`：範囲リセット
- `S,1-9,E`：再生位置を移動
- `CTRL+E`：キュー追加
- `CTRL+Q`：キュー確認
- `h,j,k,l,;`：1秒戻る、1フレーム戻る、再生/停止、1フレーム進む、1秒進む
- ダブルクリック,`f`：フルスクリーン切り替えトグル
- `SPACE`、プレビュー画面クリック：一時停止、再生
- 動画ファイルのドラッグ＆ドロップ可能

## ６．一括処理

動画ファイル選択、LADAオプション、範囲指定、切り出し設定をジョブとしてキューに登録します。
キューに登録されたジョブ群を逐次的に一括処理します。
一括処理中は単一処理はできません。
各ジョブの処理結果は処理ログで確認してください。
キューは実行フォルダの`processing_queue.json`に保存しますので再起動後も有効です。
複数ファイルをD&Dすると範囲全域、かつ、その時の画面の設定値ですべての動画ファイルをキューに登録します。

複数ファイルをD&Dすると範囲全域、かつ、その時の画面の設定値ですべての動画ファイルをキューに登録します。

## ７．VR映像対応（試行錯誤中）

Discordに投稿されていた以下のアイデアを使用して処理しています。
（１）左右それぞれ9エリアに分割
（２）各エリアをLADA処理
（３）9x2エリアの処理結果映像を結合

　　　　□□□｜□□□
　　　　□□□｜□□□-
　　　　□□□｜□□□-

処理量軽減のため簡易処理モードを用意して、この場合は黒い部分（左右それぞれ2エリア）のみLADA処理します。
-
-　　　　□□□｜□□□
-　　　　□■□｜□■□-
-　　　　□■□｜□■□-


## 更新履歴

- 20250920 初期バージョン（Gemini）
- 20250921 ドラッグ＆ドロップ対応、マルチバイトファイル名問題回避（Gemini）
- 20250922 キーボード操作を追加（Gemini）
- 20250924 品質パラーメタ追加、処理ログ記録、一括処理（Grok）
- 20250925 一括処理改善、UX改善、信頼性対策（Grok, Claude, ChatGPT）
- 20250927 プレビューフルスクリーン対応、ショートカット追加（Grok, Claude）
- 20250929 複数ファイルD&D一括登録、動画切り出し処理変更（映像品質向上）、ショートカット追加（Grok, Claude）
- 20251001 バグ修正（D&D、リネームエラー時の処理後ファイル喪失）、切り出し動画品質指定追加（Claude）
- 20251002 VR映像対応（Claude）

---

いろいろなAIを利用してVibeコーディング by undergate.

**Happy to demosaic !**
